<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SB99 | GURILA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* RESET E CORES SB99 */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Arial', sans-serif; }
        body { background-color: #f0f0f0; padding-bottom: 50px; }
        
        /* CORES */
        :root {
            --sb-green: #8bc34a; /* Verde Claro do Topo */
            --sb-dark-green: #689f38; /* Verde Escuro do Bot√£o */
            --sb-list-green: #99cc00; /* Verde da Lista */
            --bg-gray: #e0e0e0;
        }

        /* HEADER */
        .header { background-color: var(--sb-green); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; color: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .brand { font-size: 18px; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); }
        .menu-icon { font-size: 20px; cursor: pointer; }

        /* BARRA DE APOSTA (TOPO) - IGUAL PRINT */
        .bet-bar { 
            background: #fff; padding: 8px; display: flex; align-items: center; justify-content: space-between; 
            border-bottom: 1px solid #ccc; position: sticky; top: 0; z-index: 100; 
        }
        .input-money { 
            background: #e0e0e0; border: 1px solid #999; padding: 8px; width: 100px; 
            border-radius: 4px; font-size: 14px; color: #333; 
        }
        .return-info { text-align: center; font-size: 11px; color: #333; line-height: 1.3; }
        .return-info b { display: block; font-size: 14px; color: #000; }
        .btn-cupom { 
            background: var(--sb-list-green); color: #fff; font-weight: bold; 
            padding: 8px 15px; border-radius: 4px; border: none; font-size: 13px;
            box-shadow: 0 2px 2px rgba(0,0,0,0.2); cursor: pointer;
        }
        .badge { background: #ffeb3b; color: #000; padding: 1px 5px; border-radius: 3px; font-size: 10px; margin-left: 5px; }

        /* TITULO */
        .page-title { text-align: center; padding: 15px 0 5px 0; }
        .page-title h2 { font-size: 20px; font-weight: bold; color: #000; margin-bottom: 2px; }
        .page-title p { font-size: 12px; color: #666; }

        /* LISTA ACORDE√ÉO (ESTILO SB99) */
        .league-container { padding: 5px; }
        
        .league-btn {
            background: var(--sb-list-green);
            color: #fff;
            padding: 12px 15px;
            margin-bottom: 5px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            text-transform: capitalize;
        }
        .league-btn i { margin-right: 10px; }
        .league-btn .arrow { float: right; transition: 0.3s; }
        .league-btn.open .arrow { transform: rotate(180deg); }

        /* CONTEUDO DO ACORDE√ÉO (JOGOS) */
        .league-games { display: none; background: #fff; margin-bottom: 5px; border-radius: 0 0 5px 5px; overflow: hidden; }
        .league-games.show { display: block; }

        .game-row { border-bottom: 1px solid #eee; padding: 10px; display: flex; flex-direction: column; gap: 8px; }
        
        .game-info { display: flex; justify-content: space-between; font-size: 12px; color: #333; font-weight: bold; }
        .teams-names { font-size: 13px; margin-bottom: 5px; color: #000; }

        .odds-row { display: flex; gap: 5px; }
        .odd-sq { 
            flex: 1; background: #f0f0f0; border: 1px solid #ccc; 
            padding: 8px; text-align: center; border-radius: 4px; cursor: pointer; 
        }
        .odd-sq span { display: block; font-size: 10px; color: #666; }
        .odd-sq b { display: block; font-size: 12px; color: #000; }
        .odd-sq.active { background: #ffeb3b; border-color: #fdd835; } /* Amarelo ao selecionar */

        /* MENU LATERAL / LOGIN */
        .sidebar { position: fixed; top: 0; right: -250px; width: 250px; height: 100%; background: #fff; z-index: 200; transition: 0.3s; box-shadow: -2px 0 5px rgba(0,0,0,0.2); padding: 20px; }
        .sidebar.open { right: 0; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 150; display: none; }
        .overlay.open { display: block; }

        .form-group { margin-bottom: 15px; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        .btn-action { width: 100%; padding: 10px; background: var(--sb-dark-green); color: #fff; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; margin-top: 5px; }
        .btn-outline { background: transparent; border: 1px solid var(--sb-dark-green); color: var(--sb-dark-green); margin-top: 10px; }

        /* BOT√ÉO MAIS (+) */
        .btn-more { background: #333; color: #fff; width: 40px; display: flex; align-items: center; justify-content: center; border-radius: 4px; font-size: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="header">
        <div class="brand">SB99 <small style="font-size:10px;">v2.0</small></div>
        <i class="fas fa-bars menu-icon" onclick="toggleMenu()"></i>
    </div>

    <div class="bet-bar">
        <input type="number" id="valor-topo" class="input-money" placeholder="R$ 0,00" oninput="atualizarCalculo()">
        <div class="return-info">
            Poss√≠vel Retorno<br>
            <b id="retorno-topo">R$ 0,00</b>
        </div>
        <button class="btn-cupom" onclick="finalizarZap()">
            Cupom <span class="badge" id="qtd-cupom">0</span>
        </button>
    </div>

    <div class="page-title">
        <h2>Futebol</h2>
        <p>Campeonatos dispon√≠veis</p>
    </div>

    <div id="container-ligas" class="league-container">
        <div style="text-align:center; padding:20px; color:#999;">Carregando Ligas...</div>
    </div>

    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>
    <div class="sidebar" id="sidebar">
        <h3 style="margin-bottom:20px;">√Årea do Cliente</h3>
        
        <div id="form-login">
            <div class="form-group">
                <input type="email" id="email" class="form-control" placeholder="Usu√°rio / Email">
            </div>
            <div class="form-group">
                <input type="password" id="senha" class="form-control" placeholder="Senha">
            </div>
            <button class="btn-action" onclick="fazerLogin()">ENTRAR</button>
            <button class="btn-action btn-outline" onclick="mostrarCadastro()">CRIAR CONTA</button>
        </div>

        <div id="form-cadastro" style="display:none;">
            <h4 style="margin-bottom:10px;">Novo Cadastro</h4>
            <div class="form-group"><input type="text" id="cad-nome" class="form-control" placeholder="Seu Nome"></div>
            <div class="form-group"><input type="email" id="cad-email" class="form-control" placeholder="Email"></div>
            <div class="form-group"><input type="password" id="cad-senha" class="form-control" placeholder="Senha"></div>
            <button class="btn-action" onclick="fazerCadastro()">CADASTRAR</button>
            <button class="btn-action btn-outline" onclick="mostrarLogin()">VOLTAR</button>
        </div>

        <div id="user-logged" style="display:none;">
            <p>Ol√°, <b id="user-name">Usu√°rio</b></p>
            <p style="font-size:12px; color:#666;">Saldo: R$ 0,00</p>
            <button class="btn-action btn-outline" style="border-color:red; color:red;" onclick="logout()">SAIR</button>
        </div>
    </div>

    <script>
        const API_URL = 'https://gurilabet-v2-production.up.railway.app'; 
        const ZAP_NUMERO = "5561995478204"; 

        let CARRINHO = [];
        let USUARIO = JSON.parse(localStorage.getItem('sb_user'));

        // --- INICIALIZA√á√ÉO ---
        window.onload = () => {
            carregarJogos();
            verificarLogin();
        };

        // --- L√ìGICA DE DADOS ---
        async function carregarJogos() {
            try {
                // Pega os dados do backend (que busca na ESPN ou Backup)
                const res = await fetch(`${API_URL}/api/jogos`);
                const jogos = await res.json();
                renderizarLigas(jogos);
            } catch (e) {
                document.getElementById('container-ligas').innerHTML = "Erro ao carregar.";
            }
        }

        function renderizarLigas(jogos) {
            // Agrupa jogos por liga
            const grupos = {};
            jogos.forEach(j => {
                if(!grupos[j.liga]) grupos[j.liga] = [];
                grupos[j.liga].push(j);
            });

            let html = '';
            // √çcones fixos para ficar bonito igual o print (simulado)
            const icones = {
                "BRASILEIR√ÉO": "üáßüá∑", "INGLATERRA": "üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø", "ESPANHA": "üá™üá∏", 
                "IT√ÅLIA": "üáÆüáπ", "ALEMANHA": "üá©üá™", "FRAN√áA": "üá´üá∑", "PORTUGAL": "üáµüáπ"
            };

            for(let liga in grupos) {
                // Limpa nome da liga para tentar achar √≠cone
                let ligaKey = Object.keys(icones).find(k => liga.toUpperCase().includes(k)) || "‚öΩ";
                let icone = icones[ligaKey] || "‚öΩ";

                html += `
                <div class="league-btn" onclick="toggleLiga('liga-${liga.replace(/\s/g, '')}')">
                    <span>${icone} &nbsp; ${liga}</span>
                    <i class="fas fa-chevron-down arrow"></i>
                </div>
                
                <div id="liga-${liga.replace(/\s/g, '')}" class="league-games">
                `;

                grupos[liga].forEach(j => {
                    let hora = new Date(j.data).toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'});
                    html += `
                    <div class="game-row">
                        <div class="game-info">
                            <span>${hora}</span>
                            <span style="color:#666;">${j.id}</span>
                        </div>
                        <div class="teams-names">
                            ${j.home.name} x ${j.away.name}
                        </div>
                        <div class="odds-row">
                            <div class="odd-sq" onclick="addAposta(this, ${j.id}, '1', ${j.odds.casa}, '${j.home.name} x ${j.away.name}')">
                                <span>1</span><b>${j.odds.casa}</b>
                            </div>
                            <div class="odd-sq" onclick="addAposta(this, ${j.id}, 'X', ${j.odds.empate}, '${j.home.name} x ${j.away.name}')">
                                <span>X</span><b>${j.odds.empate}</b>
                            </div>
                            <div class="odd-sq" onclick="addAposta(this, ${j.id}, '2', ${j.odds.fora}, '${j.home.name} x ${j.away.name}')">
                                <span>2</span><b>${j.odds.fora}</b>
                            </div>
                            <div class="btn-more">+${Math.floor(Math.random()*20)+10}</div>
                        </div>
                    </div>`;
                });

                html += `</div>`; // Fecha div da liga
            }
            document.getElementById('container-ligas').innerHTML = html;
        }

        // --- INTERA√á√ÉO VISUAL ---
        function toggleLiga(id) {
            // Abre/Fecha a sanfona
            const el = document.getElementById(id);
            el.classList.toggle('show');
            // Gira a seta
            const btn = el.previousElementSibling;
            btn.classList.toggle('open');
        }

        // --- SISTEMA DE APOSTA ---
        function addAposta(el, id, opcao, odd, nome) {
            // Remove sele√ß√£o visual anterior
            const pai = el.parentElement;
            pai.querySelectorAll('.odd-sq').forEach(b => b.classList.remove('active'));

            // Remove do carrinho se j√° existe
            const idx = CARRINHO.findIndex(i => i.id === id);
            if(idx !== -1) {
                if(CARRINHO[idx].opcao === opcao) {
                    CARRINHO.splice(idx, 1);
                    atualizarTopo();
                    return; // Clicou no mesmo, desmarca
                }
                CARRINHO.splice(idx, 1);
            }

            // Adiciona
            CARRINHO.push({ id, opcao, odd, nome });
            el.classList.add('active'); // Amarelo
            atualizarTopo();
        }

        function atualizarTopo() {
            const qtd = CARRINHO.length;
            document.getElementById('qtd-cupom').innerText = qtd;
            
            // Calcula total das odds
            let oddsTotal = CARRINHO.reduce((acc, i) => acc * parseFloat(i.odd), 1);
            if(qtd === 0) oddsTotal = 0;

            // Pega valor do input
            const valor = parseFloat(document.getElementById('valor-topo').value) || 0;
            const retorno = valor * oddsTotal;

            document.getElementById('retorno-topo').innerText = `R$ ${retorno.toFixed(2)}`;
        }

        function atualizarCalculo() {
            atualizarTopo(); // Chama ao digitar no input
        }

        // --- FINALIZAR NO ZAP ---
        async function finalizarZap() {
            const valor = parseFloat(document.getElementById('valor-topo').value);
            if(!valor || valor <= 0) return alert("Digite o valor da aposta l√° em cima!");
            if(CARRINHO.length === 0) return alert("Selecione pelo menos 1 jogo!");

            // Envia para o backend salvar (opcional, mas bom pra registro)
            // Aqui vamos direto pro ZAP para ser r√°pido igual o sistema
            
            let oddTotal = CARRINHO.reduce((acc, i) => acc * parseFloat(i.odd), 1);
            let retorno = (valor * oddTotal).toFixed(2);
            let codigo = "SB" + Math.floor(Math.random() * 90000);

            let msg = `üü¢ *SB99 - APOSTA REALIZADA* üü¢\n\n`;
            msg += `üìÑ Bilhete: *${codigo}*\n`;
            msg += `üë§ Cliente: *${USUARIO ? USUARIO.nome : 'An√¥nimo'}*\n`;
            msg += `üìÖ Data: ${new Date().toLocaleString()}\n`;
            msg += `------------------------------\n`;
            
            CARRINHO.forEach(c => {
                msg += `‚öΩ ${c.nome}\nüéØ Palpite: ${c.opcao} (Odd: ${c.odd})\n\n`;
            });
            
            msg += `------------------------------\n`;
            msg += `üí∞ Investimento: *R$ ${valor.toFixed(2)}*\n`;
            msg += `üèÜ Retorno: *R$ ${retorno}*\n`;
            msg += `üìä Cota√ß√£o: *${oddTotal.toFixed(2)}*`;

            window.open(`https://wa.me/${ZAP_NUMERO}?text=${encodeURIComponent(msg)}`, '_blank');
            
            // Limpa tudo
            CARRINHO = [];
            document.querySelectorAll('.odd-sq.active').forEach(b => b.classList.remove('active'));
            atualizarTopo();
        }

        // --- LOGIN E CADASTRO ---
        function toggleMenu() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('overlay').classList.toggle('open');
        }
        
        function mostrarCadastro() {
            document.getElementById('form-login').style.display = 'none';
            document.getElementById('form-cadastro').style.display = 'block';
        }
        function mostrarLogin() {
            document.getElementById('form-cadastro').style.display = 'none';
            document.getElementById('form-login').style.display = 'block';
        }

        function verificarLogin() {
            if(USUARIO) {
                document.getElementById('form-login').style.display = 'none';
                document.getElementById('user-logged').style.display = 'block';
                document.getElementById('user-name').innerText = USUARIO.nome;
            }
        }

        async function fazerLogin() {
            const email = document.getElementById('email').value;
            const senha = document.getElementById('senha').value;
            // Simula√ß√£o de login r√°pido ou chame API se quiser
            if(email && senha) {
                // Tenta API
                try {
                    const res = await fetch(`${API_URL}/api/login`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email, senha})});
                    const d = await res.json();
                    if(d.sucesso) {
                        USUARIO = d.usuario; localStorage.setItem('sb_user', JSON.stringify(USUARIO));
                        verificarLogin(); alert("Logado!");
                    } else alert("Erro login");
                } catch(e) { alert("Erro conex√£o"); }
            }
        }

        async function fazerCadastro() {
            const nome = document.getElementById('cad-nome').value;
            const email = document.getElementById('cad-email').value;
            const senha = document.getElementById('cad-senha').value;
            
            try {
                const res = await fetch(`${API_URL}/api/cadastro`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({nome, email, senha})});
                const d = await res.json();
                if(d.sucesso) {
                    alert("Conta Criada! Fa√ßa Login.");
                    mostrarLogin();
                } else alert("Erro criar conta");
            } catch(e) { alert("Erro conex√£o"); }
        }

        function logout() {
            localStorage.removeItem('sb_user');
            location.reload();
        }

    </script>
</body>
</html>
