<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GURILA BET | ESPORTES</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* ESTILO GURILA BET - DARK NEON */
        body { background-color: #0d1117; color: #e6edf3; font-family: 'Inter', sans-serif; padding-bottom: 80px; }
        
        .header { background: #161b22; padding: 15px; border-bottom: 2px solid #00ff88; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 50; }
        .logo { font-size: 20px; font-weight: 900; color: #fff; letter-spacing: -1px; text-transform: uppercase; }
        .logo span { color: #00ff88; }
        
        .nav-dates { display: flex; background: #0d1117; border-bottom: 1px solid #30363d; overflow-x: auto; }
        .nav-item { flex: 1; padding: 15px; text-align: center; font-size: 12px; font-weight: bold; color: #8b949e; cursor: pointer; border-bottom: 2px solid transparent; }
        .nav-item.active { color: #00ff88; border-bottom-color: #00ff88; background: #161b22; }

        /* LISTA DE JOGOS (ESTRUTURA SB99, VISUAL GURILA) */
        .league-block { margin-top: 10px; }
        .league-header { background: #21262d; padding: 8px 15px; font-size: 10px; font-weight: 900; color: #00ff88; text-transform: uppercase; display: flex; align-items: center; gap: 8px; }
        .league-header img { width: 16px; height: 16px; }

        .match-card { display: grid; grid-template-columns: 45px 1fr auto; gap: 10px; padding: 12px; background: #161b22; border-bottom: 1px solid #30363d; align-items: center; }
        
        .match-time { font-size: 10px; color: #8b949e; text-align: center; font-weight: bold; line-height: 1.4; }
        
        .teams { display: flex; flex-direction: column; gap: 4px; overflow: hidden; }
        .team-row { display: flex; align-items: center; gap: 8px; font-size: 12px; font-weight: bold; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .team-row img { width: 18px; height: 18px; object-fit: contain; }

        .odds-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; }
        .odd-btn { 
            background: #21262d; border: 1px solid #30363d; border-radius: 6px; 
            width: 50px; height: 40px; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; cursor: pointer; transition: 0.2s;
        }
        .odd-btn span { font-size: 9px; color: #8b949e; font-weight: bold; }
        .odd-btn b { font-size: 12px; color: #00ff88; }
        
        .odd-btn.active { background: #00ff88; border-color: #00ff88; }
        .odd-btn.active span { color: #000; opacity: 0.7; }
        .odd-btn.active b { color: #000; }

        /* CUPOM FLUTUANTE */
        .cupom-float { 
            position: fixed; bottom: 15px; left: 15px; right: 15px; 
            background: #00ff88; border-radius: 12px; padding: 15px; 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 10px 30px rgba(0,255,136,0.3); z-index: 100; cursor: pointer;
            display: none; /* Escondido por padr√£o */
        }
        .cupom-info { color: #000; font-weight: 900; font-size: 14px; display: flex; flex-direction: column; }
        .cupom-info small { font-size: 10px; opacity: 0.8; }
        .cupom-icon { background: #000; color: #00ff88; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }

        /* MODAL CHEIO */
        .modal { position: fixed; inset: 0; background: #0d1117; z-index: 200; display: none; flex-direction: column; }
        .modal.open { display: flex; }
        .modal-header { padding: 15px; border-bottom: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; background: #161b22; }
        .modal-body { flex: 1; overflow-y: auto; padding: 15px; }
        .modal-footer { padding: 15px; border-top: 1px solid #30363d; background: #161b22; }

        .bet-item { background: #21262d; border-radius: 8px; padding: 12px; margin-bottom: 10px; border: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; }
        .bet-info div { font-size: 12px; font-weight: bold; color: #fff; margin-bottom: 2px; }
        .bet-info span { color: #00ff88; font-size: 11px; font-weight: bold; }
        .bet-del { color: #ff4d4d; font-weight: bold; padding: 5px; cursor: pointer; }

        .input-dark { width: 100%; background: #0d1117; border: 1px solid #30363d; color: #fff; padding: 12px; border-radius: 8px; font-weight: bold; outline: none; margin-bottom: 10px; }
        .input-dark:focus { border-color: #00ff88; }
        
        .btn-confirm { width: 100%; background: #00ff88; color: #000; padding: 15px; border-radius: 10px; font-weight: 900; text-transform: uppercase; font-size: 14px; transition: 0.2s; }
        .btn-confirm:active { transform: scale(0.98); }
        .btn-confirm:disabled { background: #30363d; color: #8b949e; }

    </style>
</head>
<body>

    <div class="header">
        <div class="logo">GURILA<span>BET</span> ü¶ç</div>
        <div id="user-area" onclick="toggleLogin()" class="text-xs font-bold text-gray-400 cursor-pointer">ENTRAR</div>
    </div>

    <div class="nav-dates">
        <div class="nav-item active" onclick="carregarJogos('hoje', this)">HOJE</div>
        <div class="nav-item" onclick="carregarJogos('amanha', this)">AMANH√É</div>
        <div class="nav-item" onclick="carregarJogos('depois', this)">S√ÅBADO</div>
    </div>

    <div id="lista-jogos" class="pb-20">
        <div class="p-10 text-center text-gray-500 text-xs font-bold animate-pulse">CARREGANDO SISTEMA...</div>
    </div>

    <div id="cupom-float" class="cupom-float" onclick="abrirModal()">
        <div class="cupom-info">
            <span>BOLETIM</span>
            <small><span id="count-bets">0</span> SELE√á√ïES</small>
        </div>
        <div class="text-right mr-3">
            <span class="block text-[10px] text-black/70 font-bold">ODD TOTAL</span>
            <span id="odd-total-float" class="text-lg font-black">1.00</span>
        </div>
        <div class="cupom-icon"><i class="fas fa-chevron-up"></i></div>
    </div>

    <div id="modal-finalizar" class="modal">
        <div class="modal-header">
            <h2 class="text-white font-black uppercase text-sm">Meu Bilhete</h2>
            <button onclick="fecharModal()" class="text-gray-500 font-bold text-xl">&times;</button>
        </div>
        <div class="modal-body">
            <div id="lista-apostas"></div>
            
            <div class="mt-4">
                <label class="text-[10px] font-bold text-gray-500 uppercase ml-1">Valor da Aposta</label>
                <div class="relative">
                    <span class="absolute left-3 top-3 text-green-500 font-bold">R$</span>
                    <input type="number" id="valor" class="input-dark pl-10 text-green-500 text-lg" value="10" oninput="calcular()">
                </div>
                
                <label class="text-[10px] font-bold text-gray-500 uppercase ml-1">Cliente</label>
                <input type="text" id="cliente" class="input-dark" placeholder="Nome do Apostador">
            </div>

            <div class="bg-[#21262d] p-4 rounded-lg mt-4 border border-[#30363d]">
                <div class="flex justify-between text-xs text-gray-400 font-bold mb-1">
                    <span>Cota√ß√£o:</span> <span id="odd-final" class="text-white">1.00</span>
                </div>
                <div class="flex justify-between items-center pt-2 border-t border-[#30363d]">
                    <span class="text-xs font-bold text-white uppercase">Retorno Poss√≠vel</span>
                    <span id="retorno" class="text-xl font-black text-[#00ff88]">R$ 0,00</span>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="btn-finalizar" onclick="enviar()" class="btn-confirm">GERAR BILHETE</button>
        </div>
    </div>

    <div id="modal-login" class="fixed inset-0 bg-black/90 z-[300] hidden items-center justify-center p-5">
        <div class="bg-[#161b22] p-5 rounded-xl w-full max-w-sm border border-[#30363d]">
            <h3 class="text-white font-bold mb-4 uppercase text-center">Login Admin</h3>
            <input id="log-email" type="email" class="input-dark" placeholder="Email">
            <input id="log-pass" type="password" class="input-dark" placeholder="Senha">
            <button onclick="fazerLogin()" class="btn-confirm mt-2">ENTRAR</button>
            <button onclick="document.getElementById('modal-login').classList.add('hidden')" class="w-full text-center text-xs text-gray-500 mt-3 font-bold">CANCELAR</button>
        </div>
    </div>

    <script>
        const API = 'https://gurilabet-v2-production.up.railway.app';
        const ZAP = "5561995478204";
        
        let CARRINHO = [];
        let DATA_ATUAL = new Date();
        
        // --- FUN√á√ïES DE CARREGAMENTO ---
        async function carregarJogos(modo, el) {
            if(el) {
                document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
                el.classList.add('active');
            }
            
            // L√≥gica de Datas
            let dataBusca = new Date();
            if(modo === 'amanha') dataBusca.setDate(dataBusca.getDate() + 1);
            if(modo === 'depois') dataBusca.setDate(dataBusca.getDate() + 2);
            
            const dataStr = dataBusca.toISOString().split('T')[0];
            
            document.getElementById('lista-jogos').innerHTML = `<div class="p-10 text-center text-gray-500 text-xs font-bold animate-pulse">BUSCANDO JOGOS...</div>`;

            try {
                const res = await fetch(`${API}/api/jogos?data=${dataStr}`);
                const jogos = await res.json();
                renderizar(jogos);
            } catch (e) {
                document.getElementById('lista-jogos').innerHTML = `<div class="p-10 text-center text-red-500 font-bold">ERRO DE CONEX√ÉO</div>`;
            }
        }

        function renderizar(jogos) {
            // Agrupar por Liga
            const grupos = {};
            jogos.forEach(j => {
                if(!grupos[j.liga]) grupos[j.liga] = [];
                grupos[j.liga].push(j);
            });

            let html = '';
            for(let liga in grupos) {
                html += `<div class="league-block">
                    <div class="league-header"><img src="${grupos[liga][0].logo_liga}"> ${liga}</div>`;
                
                grupos[liga].forEach(j => {
                    const hora = new Date(j.data).toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'});
                    html += `
                    <div class="match-card">
                        <div class="match-time">${hora}<br><span class="text-[#00ff88]">${j.status}</span></div>
                        <div class="teams">
                            <div class="team-row"><img src="${j.home.logo}"> ${j.home.name}</div>
                            <div class="team-row"><img src="${j.away.logo}"> ${j.away.name}</div>
                        </div>
                        <div class="odds-grid">
                            <div class="odd-btn" onclick="add(this, ${j.id}, '1', ${j.odds.casa}, '${j.home.name} x ${j.away.name}')">
                                <span>1</span><b>${j.odds.casa}</b>
                            </div>
                            <div class="odd-btn" onclick="add(this, ${j.id}, 'X', ${j.odds.empate}, '${j.home.name} x ${j.away.name}')">
                                <span>X</span><b>${j.odds.empate}</b>
                            </div>
                            <div class="odd-btn" onclick="add(this, ${j.id}, '2', ${j.odds.fora}, '${j.home.name} x ${j.away.name}')">
                                <span>2</span><b>${j.odds.fora}</b>
                            </div>
                        </div>
                    </div>`;
                });
                html += `</div>`;
            }
            document.getElementById('lista-jogos').innerHTML = html;
        }

        // --- CARRINHO ---
        function add(el, id, opcao, odd, nome) {
            // Remove se j√° existe o mesmo jogo (troca de odd)
            const idx = CARRINHO.findIndex(i => i.id === id);
            if(idx !== -1) CARRINHO.splice(idx, 1);
            
            // Adiciona
            CARRINHO.push({ id, opcao, odd, nome });
            
            // Visual Simples (Sem persist√™ncia complexa de cor para performance)
            el.classList.add('active');
            setTimeout(() => el.classList.remove('active'), 200); // Feedback de toque
            
            atualizarBarra();
        }

        function atualizarBarra() {
            if(CARRINHO.length > 0) {
                document.getElementById('cupom-float').style.display = 'flex';
                document.getElementById('count-bets').innerText = CARRINHO.length;
                let total = CARRINHO.reduce((acc, i) => acc * parseFloat(i.odd), 1);
                document.getElementById('odd-total-float').innerText = total.toFixed(2);
            } else {
                document.getElementById('cupom-float').style.display = 'none';
            }
        }

        function abrirModal() {
            document.getElementById('modal-finalizar').classList.add('open');
            renderizarListaCupom();
            calcular();
        }
        function fecharModal() { document.getElementById('modal-finalizar').classList.remove('open'); }

        function renderizarListaCupom() {
            let html = '';
            CARRINHO.forEach((item, index) => {
                html += `
                <div class="bet-item">
                    <div class="bet-info">
                        <div>${item.nome}</div>
                        <span>${item.opcao} @ ${item.odd}</span>
                    </div>
                    <div class="bet-del" onclick="removerItem(${index})"><i class="fas fa-trash"></i></div>
                </div>`;
            });
            document.getElementById('lista-apostas').innerHTML = html;
        }

        function removerItem(index) {
            CARRINHO.splice(index, 1);
            renderizarListaCupom();
            atualizarBarra();
            calcular();
            if(CARRINHO.length === 0) fecharModal();
        }

        function calcular() {
            const val = parseFloat(document.getElementById('valor').value) || 0;
            const odds = CARRINHO.reduce((acc, i) => acc * parseFloat(i.odd), 1);
            
            document.getElementById('odd-final').innerText = odds.toFixed(2);
            document.getElementById('retorno').innerText = `R$ ${(val * odds).toFixed(2)}`;
        }

        async function enviar() {
            const val = document.getElementById('valor').value;
            const cli = document.getElementById('cliente').value;
            const odd = document.getElementById('odd-final').innerText;

            if(!cli) return alert("Digite o nome do cliente!");

            const btn = document.getElementById('btn-finalizar');
            btn.innerText = "‚è≥ ENVIANDO...";
            btn.disabled = true;

            try {
                const res = await fetch(`${API}/api/finalizar`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ usuario_id: 1, valor: val, apostas: CARRINHO, odd_total: odd })
                });
                const d = await res.json();
                
                if(d.sucesso) {
                    let txt = `ü¶ç *GURILA BET* ü¶ç\n\nüë§ *${cli}*\nüé´ Bilhete: *${d.codigo}*\nüí∞ Valor: R$ ${val}\nüèÜ Retorno: R$ ${d.retorno}\n\nüìã *PALPITES:*\n`;
                    CARRINHO.forEach(c => txt += `‚öΩ ${c.nome}\nüëâ ${c.opcao} (${c.odd})\n`);
                    window.open(`https://wa.me/${ZAP}?text=${encodeURIComponent(txt)}`, '_blank');
                    CARRINHO = []; atualizarBarra(); fecharModal();
                } else {
                    alert(d.erro);
                }
            } catch(e) { alert("Erro conex√£o"); }
            
            btn.innerText = "GERAR BILHETE"; btn.disabled = false;
        }

        // --- SISTEMA LOGIN ---
        function toggleLogin() { document.getElementById('modal-login').classList.toggle('hidden'); document.getElementById('modal-login').classList.toggle('flex'); }
        async function fazerLogin() {
            const email = document.getElementById('log-email').value;
            const pass = document.getElementById('log-pass').value;
            try {
                const res = await fetch(`${API}/api/login`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email, senha: pass})});
                const d = await res.json();
                if(d.sucesso) {
                    document.getElementById('user-area').innerText = "ADMIN: " + d.usuario.nome;
                    document.getElementById('user-area').classList.add('text-green-500');
                    toggleLogin();
                } else alert("Erro login");
            } catch(e) { alert("Erro"); }
        }

        window.onload = () => carregarJogos('hoje');
    </script>
</body>
</html>
