<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GURILA BET | SISTEMA</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Arial', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: #e0e0e0; color: #000; padding-bottom: 60px; }
        
        /* HEADER (Preto S√≥lido) */
        .header { background: #000; height: 50px; display: flex; align-items: center; justify-content: space-between; padding: 0 10px; position: sticky; top: 0; z-index: 100; border-bottom: 3px solid #009933; }
        .logo { color: #fff; font-weight: 900; font-size: 18px; font-style: italic; }
        .btn-login { background: #333; color: #fff; border: 1px solid #555; padding: 5px 10px; font-size: 11px; border-radius: 3px; text-decoration: none; font-weight: bold; }

        /* DATA NAV (Cinza Escuro) */
        .nav-dates { background: #212121; display: flex; overflow-x: auto; white-space: nowrap; }
        .nav-item { flex: 1; padding: 10px 15px; color: #aaa; text-align: center; font-size: 11px; font-weight: bold; border-right: 1px solid #333; cursor: pointer; }
        .nav-item.active { background: #009933; color: #fff; }

        /* ESTRUTURA DO JOGO (Igual SB99) */
        .league-bar { background: linear-gradient(to bottom, #333, #000); color: #fff; padding: 8px 10px; font-size: 11px; font-weight: bold; text-transform: uppercase; border-top: 1px solid #555; display: flex; align-items: center; gap: 5px; }
        .league-bar img { height: 14px; width: 14px; }

        .match-row { background: #fff; border-bottom: 1px solid #ccc; display: flex; padding: 8px 5px; align-items: center; min-height: 55px; }
        
        /* Coluna Hora */
        .col-time { width: 40px; text-align: center; font-size: 10px; color: #333; line-height: 1.2; border-right: 1px solid #eee; margin-right: 5px; font-weight: bold; }
        
        /* Coluna Times */
        .col-teams { flex: 1; display: flex; flex-direction: column; justify-content: center; gap: 2px; }
        .team-name { font-size: 12px; font-weight: bold; color: #000; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 160px; }
        
        /* Coluna Odds (Bot√µes Quadrados) */
        .col-odds { display: flex; gap: 2px; }
        .odd-btn { 
            width: 42px; height: 38px; 
            background: #eee; border: 1px solid #ccc; 
            border-radius: 3px; 
            display: flex; flex-direction: column; 
            align-items: center; justify-content: center;
            cursor: pointer;
        }
        .odd-btn span { font-size: 9px; color: #666; font-weight: bold; }
        .odd-btn b { font-size: 11px; color: #000; font-weight: bold; }
        
        /* Estado Ativo (Amarelo ou Verde) */
        .odd-btn.active { background: #ffcc00; border-color: #c9a30a; }
        
        .btn-more { width: 30px; height: 38px; background: #333; color: #fff; font-size: 10px; font-weight: bold; display: flex; align-items: center; justify-content: center; border-radius: 3px; margin-left: 2px; }

        /* RODAP√â (Fixo Embaixo) */
        .footer-bet { position: fixed; bottom: 0; width: 100%; background: #000; border-top: 3px solid #009933; padding: 10px; display: flex; justify-content: space-between; align-items: center; z-index: 500; display: none; }
        .footer-info { color: #fff; font-size: 12px; font-weight: bold; }
        .footer-info span { color: #009933; font-size: 14px; }
        .btn-concluir { background: #009933; color: #fff; border: none; padding: 8px 20px; font-weight: bold; font-size: 12px; border-radius: 3px; text-transform: uppercase; cursor: pointer; }

        /* MODAL (Estilo Janela) */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: none; align-items: center; justify-content: center; }
        .modal-box { background: #fff; width: 90%; max-width: 400px; border-radius: 5px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .modal-header { background: #000; color: #fff; padding: 10px; font-weight: bold; display: flex; justify-content: space-between; border-bottom: 3px solid #009933; }
        .modal-body { padding: 15px; max-height: 60vh; overflow-y: auto; background: #f5f5f5; }
        .modal-footer { padding: 15px; background: #e0e0e0; text-align: center; }

        .cupom-item { background: #fff; border: 1px solid #ccc; padding: 8px; margin-bottom: 5px; border-left: 4px solid #009933; font-size: 11px; display: flex; justify-content: space-between; }
        .cupom-del { color: red; font-weight: bold; padding: 0 5px; cursor: pointer; }

        .input-sys { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 3px; margin-bottom: 10px; font-size: 14px; }
        .btn-block { width: 100%; padding: 12px; background: #009933; color: #fff; font-weight: bold; border: none; border-radius: 3px; cursor: pointer; font-size: 14px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo">GURILA<span style="color:#009933">BET</span></div>
        <a href="#" onclick="toggleLogin()" class="btn-login">LOGIN</a>
    </div>

    <div class="nav-dates">
        <div class="nav-item active" onclick="loadJogos('hoje', this)">HOJE</div>
        <div class="nav-item" onclick="loadJogos('amanha', this)">AMANH√É</div>
        <div class="nav-item" onclick="loadJogos('depois', this)">S√ÅBADO</div>
        <div class="nav-item">DOMINGO</div>
    </div>

    <div id="container-jogos">
        <div style="padding: 20px; text-align: center; font-size: 12px; color: #666;">Carregando sistema...</div>
    </div>

    <div id="footer-bet" class="footer-bet">
        <div class="footer-info">
            JOGOS: <span id="qtd-jogos">0</span> <br>
            COTA√á√ÉO: <span id="total-odd">1.00</span>
        </div>
        <button onclick="abrirModal()" class="btn-concluir">CONCLUIR APOSTA</button>
    </div>

    <div id="modal-cupom" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <span>SEU BILHETE</span>
                <span onclick="fecharModal()" style="cursor:pointer">X</span>
            </div>
            <div class="modal-body">
                <div id="lista-cupom"></div>
                
                <hr style="border: 0; border-top: 1px solid #ccc; margin: 10px 0;">
                
                <label style="font-size: 11px; font-weight: bold; color: #333;">VALOR APOSTA</label>
                <input type="number" id="valor" class="input-sys" value="2.00" oninput="calcular()">
                
                <label style="font-size: 11px; font-weight: bold; color: #333;">NOME CLIENTE</label>
                <input type="text" id="cliente" class="input-sys" placeholder="Digite o nome">

                <div style="background: #fff; padding: 10px; border: 1px solid #ccc; text-align: center;">
                    <small>RETORNO</small><br>
                    <b id="retorno" style="font-size: 18px; color: #009933;">R$ 0,00</b>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="enviarAposta()" id="btn-finalizar" class="btn-block">CONFIRMAR</button>
            </div>
        </div>
    </div>

    <div id="modal-login" class="modal-overlay">
        <div class="modal-box" style="max-width: 300px;">
            <div class="modal-header">√ÅREA RESTRITA <span onclick="toggleLogin()" style="cursor:pointer">X</span></div>
            <div class="modal-body" style="background: #fff;">
                <input type="email" id="email-login" class="input-sys" placeholder="Usu√°rio">
                <input type="password" id="senha-login" class="input-sys" placeholder="Senha">
                <button onclick="fazerLogin()" class="btn-block" style="background:#333;">ACESSAR</button>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURA√á√ïES
        const API_URL = 'https://gurilabet-v2-production.up.railway.app'; // SEU BACKEND
        const WHATSAPP = "5561995478204"; 

        let CARRINHO = [];
        let JOGOS_CACHE = [];

        // --- INICIALIZA√á√ÉO ---
        window.onload = () => {
            loadJogos('hoje', null);
        };

        async function loadJogos(dataTipo, el) {
            if(el) {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                el.classList.add('active');
            }

            let dataStr = new Date().toISOString().split('T')[0]; // Padr√£o hoje
            // L√≥gica simples de data (Pode melhorar depois)
            if(dataTipo === 'amanha') {
                let d = new Date(); d.setDate(d.getDate() + 1);
                dataStr = d.toISOString().split('T')[0];
            }

            document.getElementById('container-jogos').innerHTML = `<div style="padding: 20px; text-align: center; font-size: 12px; color: #666;">BUSCANDO DADOS...</div>`;

            try {
                // Chama seu Backend V26 (que busca na ESPN ou Backup)
                const res = await fetch(`${API_URL}/api/jogos?data=${dataStr}`);
                const jogos = await res.json();
                JOGOS_CACHE = jogos;
                renderizarLista(jogos);
            } catch (e) {
                document.getElementById('container-jogos').innerHTML = `<div style="padding: 20px; text-align: center; color: red;">ERRO AO CARREGAR<br>Verifique conex√£o</div>`;
            }
        }

        function renderizarLista(jogos) {
            // Agrupar por liga (L√≥gica SB99)
            const grupos = {};
            jogos.forEach(j => {
                if(!grupos[j.liga]) grupos[j.liga] = [];
                grupos[j.liga].push(j);
            });

            let html = '';
            for(let liga in grupos) {
                // Header da Liga (Preto com Texto Branco)
                html += `<div class="league-bar">${liga}</div>`;
                
                grupos[liga].forEach(j => {
                    const hora = new Date(j.data).toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'});
                    // Linha do Jogo (Branco com divis√≥rias)
                    html += `
                    <div class="match-row">
                        <div class="col-time">${hora}<br><span style="color:#009933">${j.status}</span></div>
                        <div class="col-teams">
                            <div class="team-name">${j.home.name}</div>
                            <div class="team-name">${j.away.name}</div>
                        </div>
                        <div class="col-odds">
                            <div class="odd-btn" onclick="addAposta(this, ${j.id}, '1', ${j.odds.casa}, '${j.home.name} x ${j.away.name}')">
                                <span>1</span><b>${j.odds.casa}</b>
                            </div>
                            <div class="odd-btn" onclick="addAposta(this, ${j.id}, 'X', ${j.odds.empate}, '${j.home.name} x ${j.away.name}')">
                                <span>X</span><b>${j.odds.empate}</b>
                            </div>
                            <div class="odd-btn" onclick="addAposta(this, ${j.id}, '2', ${j.odds.fora}, '${j.home.name} x ${j.away.name}')">
                                <span>2</span><b>${j.odds.fora}</b>
                            </div>
                            <div class="btn-more">+</div>
                        </div>
                    </div>`;
                });
            }
            document.getElementById('container-jogos').innerHTML = html;
        }

        // --- L√ìGICA DO CARRINHO (SIMPLIFICADA) ---
        function addAposta(btn, id, opcao, odd, nome) {
            // Remove sele√ß√£o visual anterior desse jogo
            const pai = btn.parentElement;
            pai.querySelectorAll('.odd-btn').forEach(b => b.classList.remove('active'));

            // Remove do array se j√° existir aposta nesse jogo
            const idx = CARRINHO.findIndex(i => i.id === id);
            if(idx !== -1) {
                // Se clicou na mesma, remove e sai (toggle)
                if(CARRINHO[idx].opcao === opcao) {
                    CARRINHO.splice(idx, 1);
                    atualizarFooter();
                    return;
                }
                CARRINHO.splice(idx, 1);
            }

            // Adiciona nova
            CARRINHO.push({ id, opcao, odd, nome });
            btn.classList.add('active'); // Fica Amarelo
            atualizarFooter();
        }

        function atualizarFooter() {
            if(CARRINHO.length > 0) {
                document.getElementById('footer-bet').style.display = 'flex';
                document.getElementById('qtd-jogos').innerText = CARRINHO.length;
                
                let total = CARRINHO.reduce((acc, item) => acc * parseFloat(item.odd), 1);
                document.getElementById('total-odd').innerText = total.toFixed(2);
            } else {
                document.getElementById('footer-bet').style.display = 'none';
            }
        }

        // --- MODAIS E FINALIZA√á√ÉO ---
        function abrirModal() {
            document.getElementById('modal-cupom').style.display = 'flex';
            renderizarCupom();
            calcular();
        }
        function fecharModal() { document.getElementById('modal-cupom').style.display = 'none'; }

        function renderizarCupom() {
            let html = '';
            CARRINHO.forEach((item, i) => {
                html += `
                <div class="cupom-item">
                    <div>
                        <b>${item.nome}</b><br>
                        Op√ß√£o: ${item.opcao} | Odd: ${item.odd}
                    </div>
                    <div class="cupom-del" onclick="removerItem(${i})">X</div>
                </div>`;
            });
            document.getElementById('lista-cupom').innerHTML = html;
        }

        function removerItem(i) {
            CARRINHO.splice(i, 1);
            renderizarCupom();
            atualizarFooter();
            calcular();
            if(CARRINHO.length === 0) fecharModal();
        }

        function calcular() {
            const val = parseFloat(document.getElementById('valor').value) || 0;
            const odds = parseFloat(document.getElementById('total-odd').innerText);
            document.getElementById('retorno').innerText = "R$ " + (val * odds).toFixed(2);
        }

        async function enviarAposta() {
            const cliente = document.getElementById('cliente').value;
            const valor = document.getElementById('valor').value;
            const oddTotal = document.getElementById('total-odd').innerText;

            if(!cliente) return alert("Informe o Cliente!");

            const btn = document.getElementById('btn-finalizar');
            btn.innerText = "AGUARDE..."; btn.disabled = true;

            try {
                // Envia para o Server V26 (que aceita e grava)
                const res = await fetch(`${API_URL}/api/finalizar`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ usuario_id: 1, valor, apostas: CARRINHO, odd_total: oddTotal })
                });
                const data = await res.json();

                if(data.sucesso) {
                    // MENSAGEM ZAP FORMATO SISTEMA
                    let msg = `*GURILA BET - COMPROVANTE*\n\n`;
                    msg += `C√≥d: *${data.codigo}*\n`;
                    msg += `Cliente: ${cliente}\n`;
                    msg += `Data: ${new Date().toLocaleString()}\n`;
                    msg += `--------------------------------\n`;
                    CARRINHO.forEach(c => {
                        msg += `‚öΩ ${c.nome}\nOp√ß√£o: ${c.opcao} (${c.odd})\n\n`;
                    });
                    msg += `--------------------------------\n`;
                    msg += `üí∞ Valor: R$ ${valor}\n`;
                    msg += `üèÜ Retorno: R$ ${data.retorno}\n`;
                    
                    window.open(`https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`, '_blank');
                    
                    CARRINHO = []; atualizarFooter(); fecharModal();
                    // Limpa sele√ß√£o visual
                    document.querySelectorAll('.odd-btn.active').forEach(b => b.classList.remove('active'));
                } else {
                    alert("Erro: " + data.erro);
                }
            } catch(e) {
                alert("Erro ao conectar no servidor.");
            }
            btn.innerText = "CONFIRMAR"; btn.disabled = false;
        }

        // --- LOGIN ADMIN ---
        function toggleLogin() { 
            const el = document.getElementById('modal-login');
            el.style.display = (el.style.display === 'flex' ? 'none' : 'flex');
        }
        async function fazerLogin() {
            // L√≥gica simples de login para teste
            alert("Sistema Protegido. Entre em contato com o suporte.");
        }

    </script>
</body>
</html>
