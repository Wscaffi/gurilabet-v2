<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GURILA BET | V31</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* ... COPIAR TODO O CSS DO V30 AQUI, MAS ADICIONE ISSO NO FINAL: ... */
        
        /* CSS DO NOVO MODAL DE MERCADOS (ABAS) */
        .modal-tabs { display: flex; overflow-x: auto; background: #000; border-bottom: 1px solid #333; }
        .tab-btn { padding: 12px 15px; color: #888; font-size: 11px; font-weight: bold; cursor: pointer; white-space: nowrap; border-bottom: 2px solid transparent; text-transform: uppercase; }
        .tab-btn.active { color: #00ff88; border-bottom-color: #00ff88; background: #161b22; }
        
        .market-group { padding: 10px; display: none; }
        .market-group.active { display: block; }
        
        .m-block { background: #0d1117; border: 1px solid #333; border-radius: 6px; margin-bottom: 10px; overflow: hidden; }
        .m-head { background: #161b22; padding: 8px 10px; font-size: 11px; font-weight: bold; color: #fff; border-bottom: 1px solid #333; display: flex; justify-content: space-between; }
        .m-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1px; background: #333; }
        .m-btn { background: #0d1117; padding: 12px; text-align: center; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .m-btn span { font-size: 11px; color: #ccc; }
        .m-btn b { font-size: 12px; color: #00ff88; }
        .m-grid-3 { grid-template-columns: 1fr 1fr 1fr; }
        
        /* Scrollbar hide */
        .modal-tabs::-webkit-scrollbar { display: none; }
    </style>
    </head>
<body>
    <div id="modal-mercados" class="modal" style="display:none; align-items: flex-end;">
        <div class="modal-box" style="height: 85vh; width: 100%; max-width: 100%; border-radius: 15px 15px 0 0;">
            <div class="modal-header">
                <span id="extra-title" style="font-size:12px; text-transform:uppercase;">FLAMENGO X VASCO</span>
                <span onclick="fecharExtras()" style="cursor:pointer; padding:5px;">&times;</span>
            </div>
            
            <div class="modal-tabs">
                <div class="tab-btn active" onclick="mudarAba('tab-princ', this)">PRINCIPAIS</div>
                <div class="tab-btn" onclick="mudarAba('tab-gols', this)">GOLS</div>
                <div class="tab-btn" onclick="mudarAba('tab-1t', this)">1º TEMPO</div>
                <div class="tab-btn" onclick="mudarAba('tab-2t', this)">2º TEMPO</div>
                <div class="tab-btn" onclick="mudarAba('tab-comb', this)">COMBINADOS</div>
            </div>

            <div class="modal-body" style="background: #000; padding: 0;">
                <div id="mercados-content">Carregando...</div>
            </div>
        </div>
    </div>

    <script>
        // ... MANTENHA TODAS AS VARIÁVEIS E FUNÇÕES (carregarJogos, renderizarLigas, etc) ...
        
        // ... SUBSTITUA APENAS A FUNÇÃO 'abrirExtras' POR ESTA NOVA LÓGICA: ...

        let JOGO_ATUAL_MERCADOS = null;

        function abrirExtras(idJogo, nomes) {
            document.getElementById('extra-title').innerText = nomes;
            document.getElementById('modal-mercados').style.display = 'flex';
            document.getElementById('mercados-content').innerHTML = '<div style="padding:20px; text-align:center; color:#888;">Carregando Odds...</div>';

            // Busca o jogo específico no array carregado
            // (Na V31, o endpoint /jogos já traz tudo, então buscamos no JOGOS_TODOS local)
            const jogo = JOGOS_TODOS.find(j => j.id == idJogo);
            
            if(jogo && jogo.mercados) {
                renderizarMercados(jogo.mercados, idJogo, nomes);
            } else {
                document.getElementById('mercados-content').innerHTML = '<div style="padding:20px; text-align:center; color:red;">Mercados fechados.</div>';
            }
        }

        function renderizarMercados(m, id, nomeJogo) {
            const btn = (sel, odd) => `<div class="m-btn" onclick="addApostaExtra(${id}, '${sel}', ${odd}, '${nomeJogo}')"><span>${sel}</span> <b>${odd}</b></div>`;
            const bloco = (titulo, grid, btns) => `<div class="m-block"><div class="m-head">${titulo}</div><div class="m-grid ${grid}">${btns}</div></div>`;

            let htmlPrinc = '', htmlGols = '', html1T = '', html2T = '', htmlComb = '';

            // ABA PRINCIPAIS
            if(m.dupla_chance) htmlPrinc += bloco("DUPLA CHANCE", "m-grid-3", btn("1X", m.dupla_chance["1X"]) + btn("12", m.dupla_chance["12"]) + btn("X2", m.dupla_chance["X2"]));
            if(m.empate_anula) htmlPrinc += bloco("EMPATE ANULA", "m-grid", btn("Casa", m.empate_anula["1"]) + btn("Fora", m.empate_anula["2"]));
            if(m.ambas_marcam) htmlPrinc += bloco("AMBAS MARCAM", "m-grid", btn("Sim", m.ambas_marcam.Sim) + btn("Não", m.ambas_marcam.Não));
            if(m.handicap) htmlPrinc += bloco("HANDICAP (RESULTADO)", "m-grid", 
                btn("Casa -1", m.handicap["Casa -1"]) + btn("Fora +1", m.handicap["Fora +1"]) +
                btn("Casa +1", m.handicap["Casa +1"]) + btn("Fora -1", m.handicap["Fora -1"])
            );

            // ABA GOLS
            if(m.total_gols) {
                let g = m.total_gols;
                htmlGols += bloco("TOTAL DE GOLS", "m-grid", 
                    btn("+1.5", g["Mais 1.5"]) + btn("-1.5", g["Menos 1.5"]) +
                    btn("+2.5", g["Mais 2.5"]) + btn("-2.5", g["Menos 2.5"]) +
                    btn("+3.5", g["Mais 3.5"]) + btn("-3.5", g["Menos 3.5"])
                );
            }
            if(m.total_gols_casa) htmlGols += bloco("GOLS DO CASA", "m-grid", btn("+0.5", m.total_gols_casa["Mais 0.5"]) + btn("+1.5", m.total_gols_casa["Mais 1.5"]));
            if(m.total_gols_fora) htmlGols += bloco("GOLS DO FORA", "m-grid", btn("+0.5", m.total_gols_fora["Mais 0.5"]) + btn("+1.5", m.total_gols_fora["Mais 1.5"]));

            // ABA 1º TEMPO
            if(m.ht_vencedor) html1T += bloco("VENCEDOR 1º TEMPO", "m-grid-3", btn("1", m.ht_vencedor["1"]) + btn("X", m.ht_vencedor["X"]) + btn("2", m.ht_vencedor["2"]));
            if(m.ht_gols) html1T += bloco("GOLS 1º TEMPO", "m-grid", btn("+0.5", m.ht_gols["Mais 0.5"]) + btn("-0.5", m.ht_gols["Menos 0.5"]));
            if(m.ht_ambas) html1T += bloco("AMBAS MARCAM HT", "m-grid", btn("Sim", m.ht_ambas.Sim) + btn("Não", m.ht_ambas.Não));

            // ABA 2º TEMPO
            if(m.ft_vencedor_2tempo) html2T += bloco("VENCEDOR 2º TEMPO", "m-grid-3", btn("1", m.ft_vencedor_2tempo["1"]) + btn("X", m.ft_vencedor_2tempo["X"]) + btn("2", m.ft_vencedor_2tempo["2"]));

            // ABA COMBINADOS/EXTRAS
            if(m.resultado_ambas) htmlComb += bloco("VENCEDOR + AMBAS MARCAM", "m-grid", 
                btn("1 & Sim", m.resultado_ambas["Casa e Sim"]) + btn("2 & Sim", m.resultado_ambas["Fora e Sim"]) +
                btn("1 & Não", m.resultado_ambas["Casa e Não"]) + btn("2 & Não", m.resultado_ambas["Fora e Não"])
            );
            if(m.placar_exato) htmlComb += bloco("PLACAR EXATO (PREVISÃO)", "m-grid-3", 
                btn("1-0", m.placar_exato["1-0"]) + btn("0-1", m.placar_exato["0-1"]) + btn("1-1", m.placar_exato["1-1"]) +
                btn("2-0", m.placar_exato["2-0"]) + btn("0-2", m.placar_exato["0-2"]) + btn("2-1", m.placar_exato["2-1"])
            );
            if(m.escanteios) htmlComb += bloco("ESCANTEIOS (TOTAL)", "m-grid", btn("+8.5", m.escanteios["Mais 8.5"]) + btn("-8.5", m.escanteios["Menos 8.5"]));

            // MONTA O HTML FINAL COM DIVS OCULTAS
            document.getElementById('mercados-content').innerHTML = `
                <div id="tab-princ" class="market-group active">${htmlPrinc || '<p style="padding:10px">Sem mercados.</p>'}</div>
                <div id="tab-gols" class="market-group">${htmlGols}</div>
                <div id="tab-1t" class="market-group">${html1T}</div>
                <div id="tab-2t" class="market-group">${html2T}</div>
                <div id="tab-comb" class="market-group">${htmlComb}</div>
            `;
        }

        function mudarAba(idTab, el) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            document.querySelectorAll('.market-group').forEach(d => d.classList.remove('active'));
            document.getElementById(idTab).classList.add('active');
        }

        function addApostaExtra(id, sel, odd, nome) {
            add({parentElement: {querySelectorAll: ()=>{return []}}, classList: {add:()=>{}}}, id, sel, odd, nome);
            fecharExtras();
            // Efeito visual de sucesso
            alert(`✅ Adicionado: ${sel} (${odd})`);
        }

        function fecharExtras() { document.getElementById('modal-mercados').style.display = 'none'; }
        
        // ... (OBS: Atualize a chamada do botão "+" na lista principal para passar os parametros certos) ...
        // No renderizarLigas, onde tem o btn-more, mude para:
        // onclick="abrirExtras(${j.id}, '${j.home.name} x ${j.away.name}')"

    </script>
</body>
</html>
