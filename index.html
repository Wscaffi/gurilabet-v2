<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GURILA BET | PROFESSIONAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background: #060a0d; color: #fff; font-family: 'Inter', sans-serif; }
        .league-header { background: #12171d; border-left: 4px solid #00ff88; padding: 12px; font-size: 11px; font-weight: 900; text-transform: uppercase; display: flex; align-items: center; gap: 10px; color: #94a3b8; }
        .match-card { background: #0f141a; border-bottom: 1px solid #1e262f; padding: 15px; display: flex; align-items: center; justify-content: space-between; position: relative; }
        .match-locked { opacity: 0.5; pointer-events: none; filter: grayscale(100%); }
        .lock-icon { position: absolute; right: 10px; top: 10px; color: #555; font-size: 14px; }
        .odd-btn { background: #1c242c; border: 1px solid #2d3741; border-radius: 6px; width: 50px; height: 42px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 11px; font-weight: 800; color: #00ff88; transition: 0.2s; cursor: pointer; }
        .odd-btn:hover { background: #2d3741; border-color: #00ff88; }
        .odd-active { background: #00ff88 !important; color: #000 !important; border-color: #00ff88 !important; }
        .market-box { background: #161b22; border: 1px solid #2d3741; border-radius: 8px; padding: 10px; margin-bottom: 10px; }
        .market-title { font-size: 10px; font-weight: 900; color: #94a3b8; text-transform: uppercase; margin-bottom: 8px; border-bottom: 1px solid #2d3741; padding-bottom: 4px; }
        .market-btn { background: #0d1117; color: #fff; padding: 12px; border-radius: 6px; text-align: center; font-size: 11px; font-bold; border: 1px solid #30363d; display: flex; justify-content: space-between; cursor: pointer; transition: 0.2s; }
        .market-btn:hover { border-color: #00ff88; }
        .market-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
        .market-grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .camp-btn { background: #11171e; border: 1px solid #2d3741; padding: 8px 15px; border-radius: 50px; white-space: nowrap; font-size: 10px; font-weight: 900; color: #94a3b8; transition: 0.2s; }
        .camp-btn.active { background: #00ff88; color: #000; border-color: #00ff88; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .cupom-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #11171e; border-top: 1px solid #00ff88; padding: 15px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; box-shadow: 0 -5px 30px rgba(0,0,0,0.9); }
    </style>
</head>
<body class="pb-24">

    <header class="p-4 bg-[#0b0f13] border-b border-gray-800 flex justify-between items-center sticky top-0 z-50">
        <h1 class="text-2xl font-black italic uppercase text-white tracking-tighter">Gurila<span class="text-green-500">Bet</span> ü¶ç</h1>
        <div id="user-area">
            <button onclick="document.getElementById('modal-cadastro').classList.remove('hidden')" class="bg-green-600 text-black px-4 py-2 rounded-lg text-[10px] font-black uppercase italic">Entrar</button>
        </div>
    </header>

    <div class="p-3 bg-[#0b0f13] sticky top-[65px] z-40 border-b border-gray-900 overflow-x-auto no-scrollbar flex gap-2" id="menu-campeonatos">
        <button onclick="filtrarLiga('Todos')" class="camp-btn active uppercase">Todos</button>
    </div>

    <main id="container-jogos" class="max-w-3xl mx-auto p-2">
        <div class="text-center py-20 text-gray-600 animate-pulse font-bold uppercase italic text-xs">Carregando Odds Seguras...</div>
    </main>

    <div id="cupom-bar" class="cupom-bar hidden">
        <div class="flex flex-col">
            <span class="text-[10px] text-gray-400 font-bold uppercase">Boletim (<span id="qtd-apostas-bar">0</span>/10)</span>
            <div class="text-white font-black text-sm">Odd: <span id="odd-total" class="text-green-500">1.00</span></div>
        </div>
        <button onclick="abrirCupomDetalhado()" class="bg-green-600 text-black font-black uppercase italic px-6 py-2 rounded-lg text-xs hover:bg-white transition">Finalizar</button>
    </div>

    <div id="modal-cupom" class="fixed inset-0 bg-black/95 z-[700] hidden flex-col justify-end">
        <div class="bg-[#161b22] rounded-t-3xl p-6 border-t border-gray-800 h-[80vh] flex flex-col">
            <div class="flex justify-between items-center mb-4 border-b border-gray-800 pb-4">
                <h3 class="text-lg font-black uppercase italic text-white">Seu Bilhete</h3>
                <button onclick="document.getElementById('modal-cupom').classList.add('hidden')" class="text-gray-500 text-2xl">&times;</button>
            </div>
            <div id="lista-apostas" class="flex-1 overflow-y-auto text-xs text-gray-300 space-y-2 mb-4"></div>
            <div class="mt-auto">
                <div class="bg-black p-4 rounded-xl border border-gray-800 mb-4">
                    <label class="text-[10px] text-gray-500 font-bold uppercase">Valor (R$)</label>
                    <input type="number" id="valor-aposta" class="w-full bg-transparent text-white font-black text-2xl outline-none mt-1" placeholder="0.00" oninput="calcularRetorno()">
                </div>
                <div class="flex justify-between text-xs font-bold text-gray-400 mb-4">
                    <span>Retorno M√°ximo:</span>
                    <div class="text-right">
                        <span id="retorno-potencial" class="text-green-500 text-xl font-black">R$ 0.00</span>
                        <div id="aviso-limite" class="text-[9px] text-red-500 font-bold uppercase hidden">Limite da Banca Aplicado</div>
                    </div>
                </div>
                <button onclick="enviarAposta()" class="w-full bg-green-600 text-black font-black p-4 rounded-xl uppercase italic">Apostar</button>
            </div>
        </div>
    </div>

    <div id="modal-extras" class="fixed inset-0 bg-[#060a0d] z-[600] hidden flex-col">
        <header class="p-4 bg-[#0b0f13] border-b border-gray-800 flex justify-between items-center sticky top-0">
            <div>
                <h3 id="modal-titulo" class="text-xs font-black uppercase text-white"></h3>
                <span class="text-[10px] text-green-500 font-bold uppercase">Mercados</span>
            </div>
            <button onclick="document.getElementById('modal-extras').classList.add('hidden')" class="w-8 h-8 bg-gray-800 rounded-full text-white font-bold">&times;</button>
        </header>
        <div id="modal-corpo" class="p-3 overflow-y-auto pb-24"></div>
    </div>

    <div id="modal-cadastro" class="fixed inset-0 bg-black/95 z-[800] hidden flex items-center justify-center p-4">
        <div class="bg-[#11171e] p-8 rounded-3xl w-full max-w-sm border border-gray-800 text-center">
            <h2 class="text-xl font-black italic mb-6 uppercase text-white">Conta</h2>
            <input id="cad-nome" type="text" placeholder="Nome" class="w-full bg-black border border-gray-800 p-4 rounded-xl mb-3 outline-none text-white">
            <input id="cad-email" type="email" placeholder="E-mail" class="w-full bg-black border border-gray-800 p-4 rounded-xl mb-3 outline-none text-white">
            <input id="cad-senha" type="password" placeholder="Senha" class="w-full bg-black border border-gray-800 p-4 rounded-xl mb-6 outline-none text-white">
            <button onclick="realizarCadastro()" class="w-full bg-green-600 text-black font-black p-4 rounded-xl uppercase">Cadastrar</button>
            <button onclick="document.getElementById('modal-cadastro').classList.add('hidden')" class="mt-4 text-xs text-gray-500 uppercase font-bold">Cancelar</button>
        </div>
    </div>

    <script>
        const API_URL = 'https://gurilabet-v2-production.up.railway.app'; 
        let todosJogos = [];
        let carrinho = [];
        let ligaAtiva = 'Todos';
        let usuario = JSON.parse(localStorage.getItem('gurila_user'));
        
        // LIMITES DA CASA
        const LIMITE_JOGOS = 10;
        const LIMITE_GANHO = 2500.00;

        if(usuario) document.getElementById('user-area').innerHTML = `<div class="bg-[#1c242c] px-3 py-1 rounded-lg border border-gray-700"><span class="block text-[8px] text-gray-400 uppercase">Saldo</span><span class="text-xs font-black text-green-500">R$ ${usuario.saldo}</span></div>`;

        function traduzir(texto) {
            const dic = { 'Brazil': 'Brasil', 'England': 'Inglaterra', 'Spain': 'Espanha', 'World': 'Mundial' };
            return dic[texto] || texto;
        }

        async function carregar() {
            try {
                const res = await fetch(`${API_URL}/api/jogos`);
                todosJogos = await res.json();
                renderizarMenuLigas();
                renderizarVitrine();
            } catch (e) { document.getElementById('container-jogos').innerHTML = "<p class='text-center py-20 text-red-500'>Erro Conex√£o</p>"; }
        }

        function renderizarMenuLigas() {
            const paises = [...new Set(todosJogos.map(j => traduzir(j.pais)))];
            let html = `<button onclick="filtrarLiga('Todos')" class="camp-btn ${ligaAtiva === 'Todos' ? 'active' : ''}">TODOS</button>`;
            paises.forEach(p => { html += `<button onclick="filtrarLiga('${p}')" class="camp-btn ${traduzir(ligaAtiva) === p ? 'active' : ''}">${p.toUpperCase()}</button>`; });
            document.getElementById('menu-campeonatos').innerHTML = html;
        }

        function filtrarLiga(liga) { ligaAtiva = liga; renderizarMenuLigas(); renderizarVitrine(); }

        function renderizarVitrine() {
            const filtrados = ligaAtiva === 'Todos' ? todosJogos : todosJogos.filter(j => traduzir(j.pais) === ligaAtiva);
            const grupos = {};
            filtrados.forEach(j => {
                const chave = `${traduzir(j.pais)} - ${j.liga}`;
                if(!grupos[chave]) grupos[chave] = [];
                grupos[chave].push(j);
            });

            let html = '';
            for(let liga in grupos) {
                html += `<div class="mb-4 rounded-lg overflow-hidden border border-[#1e262f]"><div class="league-header"><img src="${grupos[liga][0].logo_liga}" class="w-5 h-5 object-contain"><span>${liga}</span></div>`;
                grupos[liga].forEach(j => {
                    const dt = new Date(j.data);
                    const jogoId = j.id;
                    const nomeJogo = `${j.home.name} x ${j.away.name}`;
                    const bloqueado = !j.ativo; 
                    const classeBloqueio = bloqueado ? 'match-locked' : '';
                    const odds = j.odds;

                    html += `
                    <div class="match-card ${classeBloqueio}">
                        ${bloqueado ? '<i class="fas fa-lock lock-icon"></i>' : ''}
                        <div class="text-[10px] text-gray-500 font-bold w-12 text-center leading-tight">
                            ${dt.toLocaleDateString('pt-BR', {day:'2-digit', month:'2-digit'})}<br><span class="text-white text-xs font-black">${dt.toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'})}</span>
                        </div>
                        <div class="flex-1 px-4 border-l border-gray-800 ml-2">
                            <div class="flex items-center gap-2 font-bold text-[10px] mb-2 uppercase text-gray-200"><img src="${j.home.logo}" class="w-4 h-4"> ${j.home.name}</div>
                            <div class="flex items-center gap-2 font-bold text-[10px] uppercase text-gray-200"><img src="${j.away.logo}" class="w-4 h-4"> ${j.away.name}</div>
                        </div>
                        <div class="flex gap-1 items-center">
                            <button onclick="addAposta(this, ${j.id}, 'Resultado', '1', ${odds.casa}, '${nomeJogo}')" class="odd-btn"><span class="text-[6px] text-gray-500 mb-0.5">1</span>${odds.casa}</button>
                            <button onclick="addAposta(this, ${j.id}, 'Resultado', 'X', ${odds.empate}, '${nomeJogo}')" class="odd-btn"><span class="text-[6px] text-gray-500 mb-0.5">X</span>${odds.empate}</button>
                            <button onclick="addAposta(this, ${j.id}, 'Resultado', '2', ${odds.fora}, '${nomeJogo}')" class="odd-btn"><span class="text-[6px] text-gray-500 mb-0.5">2</span>${odds.fora}</button>
                            <button onclick="abrirMercados(${j.id})" class="w-8 h-10 bg-[#2d3741] hover:bg-green-600 hover:text-black rounded-lg text-white font-black text-xs ml-1 transition flex items-center justify-center">+45</button>
                        </div>
                    </div>`;
                });
                html += `</div>`;
            }
            document.getElementById('container-jogos').innerHTML = html;
        }

        // --- SISTEMA DE CUPOM COM LIMITES ---
        function addAposta(el, id, mercado, opcao, odd, nome) {
            if (odd == 0 || odd == "Bloq") return;
            
            // 1. VERIFICA√á√ÉO DE LIMITE DE JOGOS
            const jaExiste = carrinho.find(i => i.id === id && i.opcao === opcao);
            if (!jaExiste && carrinho.length >= LIMITE_JOGOS) {
                alert(`Limite m√°ximo de ${LIMITE_JOGOS} jogos atingido!`);
                return;
            }

            if(el) {
                if(el.classList.contains('odd-active')) {
                    el.classList.remove('odd-active');
                    const idx = carrinho.findIndex(i => i.id === id && i.opcao === opcao);
                    if(idx > -1) carrinho.splice(idx, 1);
                    atualizarBarraCupom(); return;
                }
                el.classList.add('odd-active');
            }
            const conflito = carrinho.findIndex(i => i.id === id && i.mercado === mercado);
            if(conflito > -1) carrinho.splice(conflito, 1);
            
            carrinho.push({ id, mercado, opcao, odd, nome });
            atualizarBarraCupom();
        }

        function atualizarBarraCupom() {
            const qtd = carrinho.length;
            if(qtd > 0) {
                document.getElementById('cupom-bar').classList.remove('hidden');
                document.getElementById('qtd-apostas-bar').innerText = qtd; // Atualiza contador 1/10
                const oddTotal = carrinho.reduce((acc, item) => acc * parseFloat(item.odd), 1).toFixed(2);
                document.getElementById('odd-total').innerText = oddTotal;
            } else { document.getElementById('cupom-bar').classList.add('hidden'); }
        }

        function abrirCupomDetalhado() {
            const lista = document.getElementById('lista-apostas');
            lista.innerHTML = '';
            carrinho.forEach((item, index) => {
                lista.innerHTML += `<div class="flex justify-between items-center bg-black p-3 rounded-lg border border-gray-800"><div><div class="text-[10px] text-gray-500 uppercase font-bold">${item.nome}</div><div class="font-bold text-green-500 text-sm">${item.mercado}: ${item.opcao}</div></div><div class="text-right"><div class="font-black text-lg text-white">${item.odd}</div><button onclick="carrinho.splice(${index},1); abrirCupomDetalhado(); atualizarBarraCupom();" class="text-[9px] text-red-500 uppercase underline">Remover</button></div></div>`;
            });
            calcularRetorno();
            document.getElementById('modal-cupom').classList.remove('hidden');
        }

        function calcularRetorno() {
            const valor = parseFloat(document.getElementById('valor-aposta').value) || 0;
            const oddTotal = parseFloat(document.getElementById('odd-total').innerText);
            let potencial = valor * oddTotal;

            // 2. VERIFICA√á√ÉO DE LIMITE DE GANHO
            const aviso = document.getElementById('aviso-limite');
            if (potencial > LIMITE_GANHO) {
                potencial = LIMITE_GANHO;
                aviso.classList.remove('hidden');
            } else {
                aviso.classList.add('hidden');
            }

            document.getElementById('retorno-potencial').innerText = `R$ ${potencial.toFixed(2)}`;
        }

        async function enviarAposta() {
            if(!usuario) { alert("Fa√ßa login!"); document.getElementById('modal-cadastro').classList.remove('hidden'); return; }
            const valor = document.getElementById('valor-aposta').value;
            if(!valor || valor <= 0) return;
            
            // Check Final Front-end
            if(carrinho.length > LIMITE_JOGOS) { alert("Muitos jogos!"); return; }

            const oddTotal = document.getElementById('odd-total').innerText;
            const res = await fetch(`${API_URL}/api/finalizar`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ usuario_id: usuario.id, valor, apostas: carrinho, odd_total: oddTotal }) });
            const data = await res.json();
            if(data.sucesso) { alert(`Aposta Confirmada: ${data.codigo}`); location.reload(); } else { alert(data.erro); }
        }

        function abrirMercados(id) {
            const j = todosJogos.find(item => item.id == id);
            if(!j || !j.mercados) return; 
            document.getElementById('modal-titulo').innerText = `${j.home.name} X ${j.away.name}`;
            const m = j.mercados; const nomeJogo = `${j.home.name} x ${j.away.name}`;
            const btn = (merc, sel, odd) => `<div onclick="addAposta(this, ${id}, '${merc}', '${sel}', ${odd}, '${nomeJogo}')" class="market-btn">${sel} <span class="text-green-500">${odd}</span></div>`;

            let html = `
                <div class="market-box"><div class="market-title">Dupla Chance</div><div class="market-grid-3">
                    ${btn('Dupla Chance', 'Casa/Empate', m.dupla_chance.casa_empate)}
                    ${btn('Dupla Chance', 'Casa/Fora', m.dupla_chance.casa_fora)}
                    ${btn('Dupla Chance', 'Empate/Fora', m.dupla_chance.empate_fora)}
                </div></div>
                <div class="market-box"><div class="market-title">Ambas Marcam</div><div class="market-grid">
                    ${btn('Ambas Marcam', 'Sim', m.ambas_marcam.sim)} ${btn('Ambas Marcam', 'N√£o', m.ambas_marcam.nao)}
                </div></div>
                 <div class="market-box"><div class="market-title">Total de Gols (Over/Under)</div><div class="market-grid">
                    ${btn('Gols', 'Mais 0.5', m.total_gols.mais_05)} ${btn('Gols', 'Menos 0.5', m.total_gols.menos_05)}
                    ${btn('Gols', 'Mais 1.5', m.total_gols.mais_15)} ${btn('Gols', 'Menos 1.5', m.total_gols.menos_15)}
                    ${btn('Gols', 'Mais 2.5', m.total_gols.mais_25)} ${btn('Gols', 'Menos 2.5', m.total_gols.menos_25)}
                    ${btn('Gols', 'Mais 3.5', m.total_gols.mais_35)} ${btn('Gols', 'Menos 3.5', m.total_gols.menos_35)}
                </div></div>
                <div class="market-box"><div class="market-title">Intervalo / Final (HT/FT)</div><div class="market-grid-3">
                    ${btn('HT/FT', 'Casa/Casa', m.intervalo_final["Casa/Casa"])}
                    ${btn('HT/FT', 'Empate/Empate', m.intervalo_final["Empate/Empate"])}
                    ${btn('HT/FT', 'Fora/Fora', m.intervalo_final["Fora/Fora"])}
                </div></div>
                 <div class="market-box"><div class="market-title">Primeiro Gol</div><div class="market-grid-3">
                    ${btn('Primeiro Gol', 'Casa', m.primeiro_gol["Casa"])} ${btn('Primeiro Gol', 'Fora', m.primeiro_gol["Fora"])} ${btn('Primeiro Gol', 'Sem Gols', m.primeiro_gol["Sem Gols"])}
                </div></div>`;
            document.getElementById('modal-corpo').innerHTML = html;
            document.getElementById('modal-extras').classList.remove('hidden');
            document.getElementById('modal-extras').classList.add('flex');
        }

        async function realizarCadastro() {
            const nome = document.getElementById('cad-nome').value;
            const email = document.getElementById('cad-email').value;
            const senha = document.getElementById('cad-senha').value;
            const res = await fetch(`${API_URL}/api/cadastro`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({nome, email, senha}) });
            const data = await res.json();
            if(data.sucesso) { localStorage.setItem('gurila_user', JSON.stringify(data.usuario)); location.reload(); } else { alert(data.erro); }
        }

        window.onload = carregar;
    </script>
</body>
</html>
