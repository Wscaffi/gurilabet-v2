<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GURILA ADMIN ü¶ç</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Arial', sans-serif; }
        body { background-color: #0d1117; color: #e6edf3; padding: 20px; }
        .card { background: #161b22; border: 1px solid #30363d; padding: 15px; margin-bottom: 15px; border-radius: 8px; border-left: 5px solid orange; }
        .header { display: flex; justify-content: space-between; margin-bottom: 10px; font-weight: bold; }
        .btn { padding: 10px; width: 100%; margin-top: 10px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-validar { background: #00ff88; color: #000; }
        .btn-excluir { background: #ff4d4d; color: #fff; margin-top: 5px; }
    </style>
</head>
<body>
    <h2 style="text-align:center; color:#00ff88;">PAINEL GURILA ü¶ç</h2>
    <div id="lista" style="margin-top:20px;">Carregando...</div>

    <script>
        const API = 'https://gurilabet-v2-production.up.railway.app'; 

        setInterval(carregar, 10000); // Atualiza a cada 10s
        window.onload = carregar;

        async function carregar() {
            try {
                const res = await fetch(`${API}/api/admin/pendentes`);
                const lista = await res.json();
                let html = '';
                if(lista.length === 0) html = '<div style="text-align:center">Sem bilhetes pendentes.</div>';
                
                lista.forEach(b => {
                    html += `
                    <div class="card">
                        <div class="header">
                            <span style="color:#fff; font-size:18px;">${b.codigo}</span>
                            <span style="color:#aaa;">${b.cliente || 'Sem Nome'}</span>
                        </div>
                        <div>Valor: <b style="color:#00ff88">R$ ${b.valor}</b></div>
                        <div>Retorno: <b>R$ ${b.retorno}</b></div>
                        <button class="btn btn-validar" onclick="validar('${b.codigo}', '${b.cliente}', '${b.valor}', '${b.retorno}')">‚úÖ VALIDAR E ENVIAR ZAP</button>
                        <button class="btn btn-excluir" onclick="excluir('${b.codigo}')">üóëÔ∏è EXCLUIR</button>
                    </div>`;
                });
                document.getElementById('lista').innerHTML = html;
            } catch(e) { console.log(e); }
        }

        async function validar(cod, cli, val, ret) {
            if(!confirm("Validar aposta?")) return;
            await fetch(`${API}/api/admin/validar`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({codigo:cod})});
            
            // --- MENSAGEM AUTOM√ÅTICA ---
            let msg = `ü¶ç *GURILA BET - APOSTA CONFIRMADA* ü¶ç\n\n` +
                      `‚úÖ *Status:* VALIDADO\n` +
                      `üé´ *Bilhete:* ${cod}\n` +
                      `üë§ *Cliente:* ${cli}\n` +
                      `üí∞ *Valor:* R$ ${val}\n` +
                      `üèÜ *Pr√™mio:* R$ ${ret}\n\n` +
                      `Boa sorte! üçÄ`;
            
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
            carregar();
        }

        async function excluir(cod) {
            if(!confirm("Excluir?")) return;
            await fetch(`${API}/api/admin/excluir`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({codigo:cod})});
            carregar();
        }
    </script>
</body>
</html>
