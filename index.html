<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GURILA BET | PROFESSIONAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background: #060a0d; color: #fff; font-family: 'Inter', sans-serif; }
        .league-header { background: #1b1b1b; border-left: 4px solid #00ff88; padding: 12px; font-size: 11px; font-weight: 900; text-transform: uppercase; display: flex; align-items: center; gap: 10px; color: #94a3b8; }
        .match-card { background: #0f141a; border-bottom: 1px solid #1e262f; padding: 15px; display: flex; align-items: center; justify-content: space-between; position: relative; }
        .odd-btn { background: #1c242c; border: 1px solid #2d3741; border-radius: 6px; width: 50px; height: 42px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 11px; font-weight: 800; color: #00ff88; transition: 0.2s; cursor: pointer; }
        .odd-btn:hover { background: #2d3741; border-color: #00ff88; }
        .odd-active { background: #00ff88 !important; color: #000 !important; border-color: #00ff88 !important; }
        .date-btn { flex: 1; padding: 12px; text-align: center; font-size: 12px; font-weight: bold; color: #888; cursor: pointer; border-bottom: 2px solid transparent; background: #1b1b1b; }
        .date-btn.active { color: #00ff88; border-bottom: 2px solid #00ff88; background: #2a2a2a; }
        .market-box { background: #161b22; border: 1px solid #2d3741; border-radius: 8px; padding: 10px; margin-bottom: 10px; }
        .market-title { font-size: 10px; font-weight: 900; color: #94a3b8; text-transform: uppercase; margin-bottom: 8px; border-bottom: 1px solid #2d3741; padding-bottom: 4px; }
        .market-btn { background: #0d1117; color: #fff; padding: 12px; border-radius: 6px; text-align: center; font-size: 11px; font-bold; border: 1px solid #30363d; display: flex; justify-content: space-between; cursor: pointer; transition: 0.2s; }
        .market-btn:hover { border-color: #00ff88; }
        .market-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
        .market-grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .cupom-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #11171e; border-top: 1px solid #00ff88; padding: 15px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; box-shadow: 0 -5px 30px rgba(0,0,0,0.9); }
        .camp-btn { background: #11171e; border: 1px solid #2d3741; padding: 8px 15px; border-radius: 50px; white-space: nowrap; font-size: 10px; font-weight: 900; color: #94a3b8; transition: 0.2s; }
        .camp-btn.active { background: #00ff88; color: #000; border-color: #00ff88; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .live-pulse { animation: pulseRed 1.5s infinite; color: #ef4444; }
        @keyframes pulseRed { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .hidden { display: none !important; }
        .flex { display: flex; }
    </style>
</head>
<body class="pb-24">

    <header class="p-4 bg-[#0b0f13] border-b border-gray-800 flex justify-between items-center sticky top-0 z-50">
        <h1 class="text-2xl font-black italic uppercase text-white tracking-tighter">Gurila<span class="text-green-500">Bet</span> ü¶ç</h1>
        <div id="user-area"><button onclick="abrirModalAuth()" class="text-xs font-bold bg-[#333] px-4 py-2 rounded text-[#00ff88] border border-[#00ff88]">ENTRAR</button></div>
    </header>

    <div class="flex bg-[#1b1b1b] border-b border-[#333]">
        <div id="btn-aovivo" onclick="mudarData('aovivo')" class="date-btn flex items-center justify-center gap-1"><span class="live-pulse">‚óè</span> AO VIVO</div>
        <div id="btn-hoje" onclick="mudarData('hoje')" class="date-btn active">HOJE</div>
        <div id="btn-amanha" onclick="mudarData('amanha')" class="date-btn">AMANH√É</div>
    </div>
    
    <div class="p-3 bg-[#0b0f13] overflow-x-auto no-scrollbar flex gap-2" id="menu-campeonatos">
        <button onclick="filtrarLiga('Todos')" class="camp-btn active uppercase">Todos</button>
    </div>

    <main id="container-jogos" class="max-w-3xl mx-auto p-2 pb-40">
        <div class="text-center py-20 text-gray-600 animate-pulse font-bold uppercase italic text-xs">Carregando Jogos...</div>
    </main>

    <div id="cupom-bar" class="cupom-bar hidden">
        <div class="flex flex-col">
            <span class="text-[10px] text-gray-400 font-bold uppercase">Boletim (<span id="qtd-apostas-bar">0</span>)</span>
            <div class="text-white font-black text-sm">Odd: <span id="odd-total" class="text-green-500">1.00</span></div>
        </div>
        <button onclick="abrirCupomDetalhado()" class="bg-green-600 text-black font-black uppercase italic px-6 py-2 rounded-lg text-xs hover:bg-white transition">Finalizar</button>
    </div>

    <div id="modal-cupom" class="fixed inset-0 bg-black/95 z-[700] hidden flex-col justify-end">
        <div class="bg-[#161b22] rounded-t-3xl p-6 border-t border-gray-800 h-[80vh] flex flex-col">
            <div class="flex justify-between items-center mb-4 border-b border-gray-800 pb-4">
                <h3 class="text-lg font-black uppercase italic text-white">Seu Bilhete</h3>
                <button onclick="document.getElementById('modal-cupom').classList.add('hidden')" class="text-gray-500 text-2xl">&times;</button>
            </div>
            <div id="lista-apostas" class="flex-1 overflow-y-auto text-xs text-gray-300 space-y-2 mb-4"></div>
            <div class="mt-auto">
                <div class="bg-black p-4 rounded-xl border border-gray-800 mb-4">
                    <label class="text-[10px] text-gray-500 font-bold uppercase">Valor (R$)</label>
                    <input type="number" id="valor-aposta" class="w-full bg-transparent text-white font-black text-2xl outline-none mt-1" placeholder="0.00" oninput="calcularRetorno()">
                </div>
                <div class="flex justify-between text-xs font-bold text-gray-400 mb-4">
                    <span>Retorno:</span>
                    <span id="retorno-potencial" class="text-green-500 text-xl font-black">R$ 0.00</span>
                </div>
                <button onclick="enviarAposta()" class="w-full bg-green-600 text-black font-black p-4 rounded-xl uppercase italic">Apostar</button>
            </div>
        </div>
    </div>

    <div id="modal-mercados" class="fixed inset-0 bg-[#060a0d] z-[600] hidden flex-col">
        <header class="p-4 bg-[#0b0f13] border-b border-gray-800 flex justify-between items-center sticky top-0">
            <div><h3 id="modal-titulo" class="text-xs font-black uppercase text-white"></h3><span class="text-[10px] text-green-500 font-bold uppercase">Mercados</span></div>
            <button onclick="document.getElementById('modal-mercados').classList.add('hidden')" class="w-8 h-8 bg-gray-800 rounded-full text-white font-bold">&times;</button>
        </header>
        <div id="modal-corpo" class="p-3 overflow-y-auto pb-24"></div>
    </div>

    <div id="modal-auth" class="fixed inset-0 bg-black/95 z-[800] hidden flex items-center justify-center p-4">
        <div class="bg-[#11171e] p-8 rounded-3xl w-full max-w-sm border border-gray-800">
            <div class="flex justify-center mb-6 border-b border-[#333]">
                <button onclick="mudarAbaAuth('login')" id="tab-login" class="px-6 py-2 text-sm font-bold text-[#00ff88] border-b-2 border-[#00ff88] w-1/2">Entrar</button>
                <button onclick="mudarAbaAuth('cadastro')" id="tab-cadastro" class="px-6 py-2 text-sm font-bold text-gray-500 border-b-2 border-transparent w-1/2">Cadastrar</button>
            </div>
            <div id="form-login">
                <input id="log-email" type="email" class="w-full bg-black p-3 mb-2 rounded border border-[#333] text-white text-sm" placeholder="Email">
                <input id="log-senha" type="password" class="w-full bg-black p-3 mb-4 rounded border border-[#333] text-white text-sm" placeholder="Senha">
                <button onclick="fazerLogin()" class="w-full bg-[#00ff88] text-black font-black p-3 rounded uppercase text-xs">Acessar</button>
            </div>
            <div id="form-cadastro" class="hidden">
                <input id="cad-nome" type="text" class="w-full bg-black p-3 mb-2 rounded border border-[#333] text-white text-sm" placeholder="Nome">
                <input id="cad-email" type="email" class="w-full bg-black p-3 mb-2 rounded border border-[#333] text-white text-sm" placeholder="Email">
                <input id="cad-senha" type="password" class="w-full bg-black p-3 mb-4 rounded border border-[#333] text-white text-sm" placeholder="Senha">
                <button onclick="fazerCadastro()" class="w-full bg-[#00ff88] text-black font-black p-3 rounded uppercase text-xs">Criar</button>
            </div>
            <button onclick="toggleModal('modal-auth')" class="mt-4 text-xs text-gray-500 w-full text-center">Cancelar</button>
        </div>
    </div>

    <div id="modal-validador" class="fixed inset-0 bg-black/95 z-[900] hidden flex items-center justify-center p-4">
        <div class="bg-[#161b22] p-6 rounded-2xl w-full max-w-sm border border-gray-800 text-center">
            <h2 class="text-lg font-black text-green-500 uppercase mb-4">Validar Bilhete</h2>
            <input id="val-codigo" type="text" placeholder="C√ìDIGO" class="w-full bg-black p-3 mb-4 rounded border border-[#333] text-white text-center uppercase font-bold outline-none">
            <button onclick="validar()" class="w-full bg-white text-black font-bold p-3 rounded uppercase text-xs">Verificar</button>
            <div id="res-validacao" class="mt-4 text-xs text-left bg-black p-3 rounded border border-[#333] hidden"></div>
            <button onclick="toggleModal('modal-validador')" class="mt-2 text-xs text-gray-500">Fechar</button>
        </div>
    </div>

    <script>
        const API = 'https://gurilabet-v2-production.up.railway.app';
        const ZAP = '556100000000'; // SEU ZAP
        let JOGOS = [], FILTRO = [], CARRINHO = [], USER = JSON.parse(localStorage.getItem('gurila_user'));
        let LIGA = 'Todos', DATA = new Date().toISOString().split('T')[0], MODO = 'hoje';

        window.onload = () => { verificarLogin(); mudarData('hoje'); };

        function verificarLogin() {
            if(USER) {
                document.getElementById('user-area').innerHTML = `<div class="flex flex-col text-right leading-tight"><span class="text-[10px] text-gray-400">Ol√°, ${USER.nome.split(' ')[0]}</span><span onclick="logout()" class="text-xs font-bold text-[#00ff88] cursor-pointer">R$ ${USER.saldo}</span></div>`;
            } else {
                document.getElementById('user-area').innerHTML = `<button onclick="abrirModalAuth()" class="text-xs font-bold bg-[#333] px-4 py-2 rounded text-[#00ff88] border border-[#00ff88]">ENTRAR</button>`;
            }
        }

        function mudarData(tipo) {
            document.querySelectorAll('.date-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${tipo}`).classList.add('active');
            MODO = tipo;
            let d = new Date();
            if(tipo === 'amanha') d.setDate(d.getDate() + 1);
            if(tipo === 'depois') d.setDate(d.getDate() + 2);
            DATA = d.toISOString().split('T')[0];
            carregarJogos();
        }

        async function carregarJogos() {
            document.getElementById('container-jogos').innerHTML = '<div class="text-center py-20 text-gray-600 animate-pulse font-bold uppercase italic text-xs">Carregando Jogos...</div>';
            let url = `${API}/api/jogos?` + (MODO === 'aovivo' ? 'aovivo=true' : `data=${DATA}`);
            try {
                let res = await fetch(url);
                JOGOS = await res.json();
                FILTRO = JOGOS;
                if(JOGOS.length === 0) { document.getElementById('container-jogos').innerHTML = '<div class="text-center py-20 text-gray-500 font-bold">Nenhum jogo encontrado.</div>'; return; }
                renderizarLigas(); renderizarJogos();
            } catch(e) { document.getElementById('container-jogos').innerHTML = '<div class="text-center text-red-500 py-20">Erro Conex√£o</div>'; }
        }

        function renderizarLigas() {
            let ligas = [...new Set(JOGOS.map(j => j.liga))];
            let html = `<button onclick="filtrarLiga('Todos')" class="camp-btn ${LIGA === 'Todos' ? 'active' : ''}">TODOS</button>`;
            ligas.forEach(l => html += `<button onclick="filtrarLiga('${l}')" class="camp-btn ${LIGA === l ? 'active' : ''}">${l}</button>`);
            document.getElementById('menu-campeonatos').innerHTML = html;
        }

        function filtrarLiga(nome) { LIGA = nome; renderizarJogos(); renderizarLigas(); }

        function renderizarJogos() {
            let lista = LIGA === 'Todos' ? FILTRO : FILTRO.filter(j => j.liga === LIGA);
            let grupos = {};
            lista.forEach(j => { if(!grupos[j.liga]) grupos[j.liga] = []; grupos[j.liga].push(j); });

            let html = '';
            for(let liga in grupos) {
                let info = grupos[liga][0];
                html += `<div class="mb-4 rounded-lg overflow-hidden border border-[#2a2a2a]"><div class="league-header"><img src="${info.bandeira_pais}" class="w-5 h-4 rounded"><span>${liga}</span></div>`;
                grupos[liga].forEach(j => {
                    let hora = new Date(j.data).toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'});
                    let aoVivo = ['1H','2H','HT'].includes(j.status);
                    
                    html += `
                    <div class="match-card">
                        <div class="text-[10px] text-gray-500 font-bold w-10 text-center leading-tight mr-2">${aoVivo ? `<span class="text-red-500 font-black animate-pulse">${j.status}</span>` : hora}</div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 text-[11px] font-bold text-gray-300 mb-1"><img src="${j.home.logo}" class="w-4 h-4"> ${j.home.name}</div>
                            <div class="flex items-center gap-2 text-[11px] font-bold text-gray-300"><img src="${j.away.logo}" class="w-4 h-4"> ${j.away.name}</div>
                        </div>
                        <div class="flex gap-1">
                            <div onclick="addAposta(${j.id}, '1', ${j.odds.casa}, '${j.home.name} x ${j.away.name}', 'Resultado', this)" class="odd-btn" id="btn-${j.id}-1"><span class="text-[8px] text-gray-500">1</span><span class="text-[#00ff88] font-bold">${j.odds.casa}</span></div>
                            <div onclick="addAposta(${j.id}, 'X', ${j.odds.empate}, '${j.home.name} x ${j.away.name}', 'Resultado', this)" class="odd-btn" id="btn-${j.id}-X"><span class="text-[8px] text-gray-500">X</span><span class="text-[#00ff88] font-bold">${j.odds.empate}</span></div>
                            <div onclick="addAposta(${j.id}, '2', ${j.odds.fora}, '${j.home.name} x ${j.away.name}', 'Resultado', this)" class="odd-btn" id="btn-${j.id}-2"><span class="text-[8px] text-gray-500">2</span><span class="text-[#00ff88] font-bold">${j.odds.fora}</span></div>
                            <div onclick="abrirMercados(${j.id})" class="odd-btn bg-[#333] w-[30px] hover:bg-[#00ff88] hover:text-black transition"><span class="text-[10px] font-bold">+</span></div>
                        </div>
                    </div>`;
                });
                html += `</div>`;
            }
            document.getElementById('container-jogos').innerHTML = html;
            atualizarBotoes();
        }

        // --- SISTEMA DE CUPOM ---
        function addAposta(id, opcao, odd, nome, mercado, el) {
            CARRINHO = CARRINHO.filter(i => i.id !== id);
            CARRINHO.push({ id, opcao, odd, nome, mercado });
            if(CARRINHO.length > 10) { alert("M√°ximo 10 jogos"); CARRINHO.pop(); }
            atualizarBotoes(); atualizarCupomFloat();
        }
        function atualizarBotoes() {
            document.querySelectorAll('.odd-btn').forEach(b => b.classList.remove('odd-active'));
            CARRINHO.forEach(item => { let btn = document.getElementById(`btn-${item.id}-${item.opcao}`); if(btn) btn.classList.add('odd-active'); });
        }
        function atualizarCupomFloat() {
            if(CARRINHO.length > 0) { document.getElementById('cupom-bar').classList.remove('hidden'); document.getElementById('qtd-apostas-bar').innerText = CARRINHO.length; let t = CARRINHO.reduce((a,b)=>a*Number(b.odd),1); let v = document.getElementById('valor-aposta').value||0; document.getElementById('odd-total').innerText = t.toFixed(2); } 
            else document.getElementById('cupom-bar').classList.add('hidden');
        }
        function abrirCupomDetalhado() { toggleModal('modal-cupom'); let html=''; CARRINHO.forEach((i,x)=>{html+=`<div class="bg-[#333] p-3 rounded mb-2 flex justify-between items-center"><div><div class="text-[10px] text-gray-400 font-bold uppercase">${i.nome}</div><div class="text-xs font-bold text-white"><span class="text-[#00ff88]">${i.mercado}</span> : ${i.opcao}</div></div><div class="text-right"><div class="font-bold text-[#00ff88]">${i.odd}</div><button onclick="rmItem(${x})" class="text-[10px] text-red-500 underline">Remover</button></div></div>`}); document.getElementById('lista-apostas').innerHTML=html; calcRetorno(); }
        function rmItem(x) { CARRINHO.splice(x,1); abrirCupomDetalhado(); atualizarBotoes(); atualizarCupomFloat(); if(CARRINHO.length===0) toggleModal('modal-cupom'); }
        function definirValor(v) { document.getElementById('valor-aposta').value=v; calcRetorno(); }
        function limparCupom() { CARRINHO=[]; atualizarBotoes(); atualizarCupomFloat(); toggleModal('modal-cupom'); }
        function calcRetorno() { let v=parseFloat(document.getElementById('valor-aposta').value)||0; let odd=CARRINHO.reduce((a,b)=>a*Number(b.odd),1); let ret=v*odd; if(ret>2500) ret=2500; document.getElementById('odd-total').innerText=odd.toFixed(2); document.getElementById('retorno-potencial').innerText=`R$ ${ret.toFixed(2)}`; }
        
        async function enviarAposta() {
            let nome=USER?USER.nome:'Cliente';
            let valor=document.getElementById('valor-aposta').value;
            if(!valor) return alert("Digite o valor");
            let oddTotal=document.getElementById('odd-total').innerText;
            
            // SEU ZAP AQUI
            const SEU_ZAP = "556100000000";

            const res = await fetch(`${API}/api/finalizar`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ usuario_id: USER?USER.id:1, valor, apostas: CARRINHO, odd_total: oddTotal }) });
            const data = await res.json();
            if(data.sucesso) {
                let msg = `ü¶ç *GURILA BET* ü¶ç\nüë§: ${nome}\nC√≥d: *${data.codigo}*\nValor: R$ ${valor}\nRetorno: R$ ${data.retorno}\n\n`;
                CARRINHO.forEach(i=>msg+=`‚öΩ ${i.nome}\nüëâ ${i.opcao} (${i.odd})\n`);
                window.open(`https://wa.me/${SEU_ZAP}?text=${encodeURIComponent(msg)}`);
                limparCupom();
            } else alert(data.erro);
        }

        // --- SISTEMA DE MERCADOS EXTRAS (CORRE√á√ÉO) ---
        function abrirMercados(id) {
            let j = JOGOS.find(x => x.id === id);
            document.getElementById('titulo-mercado').innerText = `${j.home.name} x ${j.away.name}`;
            let m = j.mercados;
            let html = '';
            const addM = (t, i) => { html += `<div class="market-box"><div class="market-title text-[10px] font-bold text-gray-500 uppercase mb-2">${t}</div><div class="grid grid-cols-2 gap-2">`; i.forEach(x => html += `<div onclick="addAposta(${id}, '${x.sel}', ${x.val}, '${j.home.name} x ${j.away.name}', '${t}', null); toggleModal('modal-mercados')" class="market-btn"><span>${x.sel}</span><span class="text-[#00ff88]">${x.val}</span></div>`); html += `</div></div>`; };
            
            addM('Dupla Chance', [{sel:'Casa/Emp',val:m.dupla_chance.casa_empate}, {sel:'Casa/Fora',val:m.dupla_chance.casa_fora}, {sel:'Emp/Fora',val:m.dupla_chance.empate_fora}]);
            addM('Total Gols', [{sel:'+1.5',val:m.total_gols.mais_15}, {sel:'-1.5',val:m.total_gols.menos_15}, {sel:'+2.5',val:m.total_gols.mais_25}, {sel:'-2.5',val:m.total_gols.menos_25}]);
            addM('Ambas Marcam', [{sel:'Sim',val:m.ambas_marcam.sim}, {sel:'N√£o',val:m.ambas_marcam.nao}]);
            addM('Intervalo', [{sel:'Casa',val:m.intervalo_final["Casa/Casa"]}, {sel:'Empate',val:m.intervalo_final["Empate/Empate"]}, {sel:'Fora',val:m.intervalo_final["Fora/Fora"]}]);
            addM('Placar Exato', [{sel:'1-0',val:m.placar_exato["1-0"]}, {sel:'2-0',val:m.placar_exato["2-0"]}, {sel:'0-0',val:m.placar_exato["0-0"]}]);
            
            document.getElementById('lista-mercados').innerHTML = html;
            toggleModal('modal-mercados');
        }

        // AUTH & VALIDA√á√ÉO
        function toggleModal(id){ let el=document.getElementById(id); el.style.display=(el.style.display==='flex')?'none':'flex'; }
        function mudarAbaAuth(aba){ document.getElementById('form-login').classList.toggle('hidden',aba!=='login'); document.getElementById('form-cadastro').classList.toggle('hidden',aba!=='cadastro'); document.getElementById('tab-login').classList.toggle('text-[#00ff88]',aba==='login'); document.getElementById('tab-cadastro').classList.toggle('text-[#00ff88]',aba==='cadastro'); }
        function abrirModalAuth(){ toggleModal('modal-auth'); mudarAbaAuth('login'); }
        async function fazerLogin(){ let email=document.getElementById('log-email').value, senha=document.getElementById('log-senha').value; let res=await fetch(`${API}/api/login`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,senha})}); let data=await res.json(); if(data.sucesso){ localStorage.setItem('gurila_user',JSON.stringify(data.usuario)); USER=data.usuario; location.reload(); } else alert(data.erro); }
        async function fazerCadastro(){ let nome=document.getElementById('cad-nome').value, email=document.getElementById('cad-email').value, senha=document.getElementById('cad-senha').value; let res=await fetch(`${API}/api/cadastro`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({nome,email,senha})}); let data=await res.json(); if(data.sucesso){ localStorage.setItem('gurila_user',JSON.stringify(data.usuario)); USER=data.usuario; location.reload(); } else alert(data.erro); }
        function logout(){ localStorage.removeItem('gurila_user'); location.reload(); }
        async function validar(){ let cod=document.getElementById('val-codigo').value; let res=await fetch(`${API}/api/bilhete/${cod}`); let data=await res.json(); let div=document.getElementById('res-validacao'); div.classList.remove('hidden'); if(data.sucesso) div.innerHTML=`<span class="text-[#00ff88] font-bold">‚úÖ V√ÅLIDO</span><br>R$ ${data.bilhete.valor} -> R$ ${data.bilhete.retorno}`; else div.innerHTML='<span class="text-red-500 font-bold">‚ùå INV√ÅLIDO</span>'; }
    </script>
</body>
</html>
